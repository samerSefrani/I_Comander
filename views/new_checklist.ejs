<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="/style/new_check_list.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css">
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-min.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="/style/icmd.css">
    <title>create a checklist</title>
    <script>
            function getServerData(path) {
                return fetch(path, {method: 'GET', credentials: "same-origin"}).then(r => {
                    if (!r.ok) throw Error(r.statusText);
                    return r.json();
                })
            }
            let checklistdb_p = (getServerData('/api/get_checklist'));
            let responses = []
            responses.push(checklistdb_p);
            // console.log(responses)
            let listsdb = []
            Promise.all(responses).then(value => {
                listsdb.push(value[0].lists)
                
            })
            console.log(listsdb[1])

    </script>
</head>

<body>
<div id="layout">
        <%include partials/dashboard_menu.ejs%>
        <div id="main">
        <button type="button" class="pure-button-primary pure-button" style="width: 100%; height: 50px; border-radius: 0px 0px 0px 0px; padding: 0px; margin: 0px; background-color: black">Manage Checklist</button>
        </div>
</div>
<div class="container mainDiv">
    <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Checklists</a>
            </li>
            <li class="nav-item">
            <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Sub-lists</a>
            </li>
    </ul>
    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
            <button type="button" class="createChecklistBtn btn btn-outline-dark btn-sm">Create Checklist</button>
            <div id="accordion">
                    <h3 class="row createNewChecklist1" style="overflow: hidden;">
                        <input type="text" placeholder="Checklist name" class="form-control col-md-5" style="display: inline-block;">
                            <button type="button" class="btn btn-outline-dark btn-sm float-right">Save</button>
                    </h3>
                    <div class="createNewChecklist2">
                        <ul id="sortable" class="sortable0">
                        </ul>
                        <div class="row createElements">
                            <input type="text" class="form-control col-md-2" id="createSid" placeholder="sid">
                            <input type="text" class="form-control col-md-2" id="createLabel" placeholder="Label">
                            <input type="text" class="form-control col-md-2" id="createList" placeholder="List">
                            <div class="dropdown dropdown1" id="createAction">
                                    <button type="button" class="btn btn-outline-dark dropdown-toggle dropdown-toggle1 btn-md" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="font-size: 0.70rem;">Action</button>
                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                        <a class="dropdown-item" href="#" id="createElementsActionNone">None</a>
                                        <a class="dropdown-item" href="#" id="createElementsActionLockout">Lock Out</a>
                                        <a class="dropdown-item" href="#" id="createElementsActionTicket">Ticket</a>
                                    </div>
                            </div>
                            <input type="text" class="form-control col-md-2" id="createTrigger" placeholder="Trigger">
                            <input type="text" class="form-control col-md-2" id="createAlert" placeholder="Alert">
                            <input type="text" class="form-control col-md-2" id="createTicket" placeholder="ticket">
                        </div>
                        <br style="color: black;"/>
                        <div class="row">
                            <div class="dropdown dropdown2 float-left col-md-5">
                                    <button type="button" class="btn btn-outline-dark dropdown-toggle dropdown-toggle2 btn-sm" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="width: 100%;">Add New Item</button>
                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                        <a class="dropdown-item" href="#" id="createElementsSublist">Sublist</a>
                                        <a class="dropdown-item" href="#" id="createElementsDropDown">DropDown</a>
                                        <a class="dropdown-item" href="#" id="createElementsCheckBox">CheckBox</a>
                                        <a class="dropdown-item" href="#" id="createElementsInput">Input</a>
                                    </div>
                            </div>
                            <button type="button" class="btn btn-outline-dark btn-sm saveItemBtn col-md-5" data-toggle="" aria-haspopup="true" aria-expanded="false" style="margin-left: 1%;">Save</button>
                        </div>
                    </div>
                    <h3 class="row" style="overflow: hidden;">
                        Marvic drone
                            <button type="button" class="btn btn-outline-dark btn-sm float-right">Edit</button>
                            <button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button>
                    </h3>
                    <div>
                        <ul id="sortable" class="sortable0">
                                <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>Required Documentation-Universal<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                                <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>In-field and pre-flight checklist-INS 01<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                                <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>Hardware<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                                <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>Easyware<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                        </ul>
                    </div>
                    <h3 class="row" style="overflow: hidden;">
                            Marvic drone 2
                                <button type="button" class="btn btn-outline-dark btn-sm float-right">Edit</button>
                                <button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button>
                        </h3>
                        <div>
                            <ul id="sortable" class="sortable0">
                                    <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>Required Documentation-Universal<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                                    <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>In-field and pre-flight checklist-INS 01<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                                    <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>Hardware<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                                    <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>Easyware<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                            </ul>
                        </div>
                        <h3 class="row" style="overflow: hidden;">
                                Big Marvic drone
                                    <button type="button" class="btn btn-outline-dark btn-sm float-right">Edit</button>
                                    <button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button>
                            </h3>
                            <div>
                                <ul id="sortable" class="sortable0">
                                        <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>Required Documentation-Universal<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                                        <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>In-field and pre-flight checklist-INS 01<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                                        <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>Hardware<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                                        <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>Easyware<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                                </ul>
                            </div>
            </div>
        </div>


        <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                <button type="button" class="createChecklistBtnSublist btn btn-outline-dark btn-sm">Create sub-list</button>
                <div id="accordion2">
                        <h3 class="row createNewChecklist1Sublist" style="overflow: hidden;">
                            <input type="text" placeholder="Sub-list name" class="form-control col-md-5" style="display: inline-block;">
                                <button type="button" class="btn btn-outline-dark btn-sm float-right">Save</button>
                        </h3>
                        <div class="createNewChecklist2Sublist">
                            <ul id="sortable" class="sortable0">
                            </ul>
                            <div class="row createElementsSublist">
                                <input type="text" class="form-control col-md-2" id="createSidSublist" placeholder="sid">
                                <input type="text" class="form-control col-md-2" id="createLabelSublist" placeholder="Label">
                                <input type="text" class="form-control col-md-2" id="createListSublist" placeholder="List">
                                <div class="dropdown dropdown1" id="createActionSublist">
                                        <button type="button" class="btn btn-outline-dark dropdown-toggle dropdown-toggle1 btn-md" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="font-size: 0.70rem;">Action</button>
                                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                            <a class="dropdown-item" href="#" id="createElementsActionNoneSublist">None</a>
                                            <a class="dropdown-item" href="#" id="createElementsActionLockoutSublist">Lock Out</a>
                                            <a class="dropdown-item" href="#" id="createElementsActionTicketSublist">Ticket</a>
                                        </div>
                                </div>
                                <input type="text" class="form-control col-md-2" id="createTriggerSublist" placeholder="Trigger">
                                <input type="text" class="form-control col-md-2" id="createAlertSublist" placeholder="Alert">
                                <input type="text" class="form-control col-md-2" id="createTicketSublist" placeholder="ticket">
                            </div>
                            <br style="color: black;"/>
                            <div class="row">
                                <div class="dropdown dropdown2 float-left row col-md-5">
                                        <button type="button" class="btn btn-outline-dark dropdown-toggle dropdown-toggle2 btn-sm" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="width: 100%;">Add New Item</button>
                                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                            <a class="dropdown-item" href="#" id="createElementsSublistSublist">Sublist</a>
                                            <a class="dropdown-item" href="#" id="createElementsDropDownSublist">DropDown</a>
                                            <a class="dropdown-item" href="#" id="createElementsCheckBoxSublist">CheckBox</a>
                                            <a class="dropdown-item" href="#" id="createElementsInputSublist">Input</a>
                                        </div>
                                </div>
                                <button type="button" class="btn btn-outline-dark btn-sm saveItemBtnSublist col-md-5" data-toggle="" aria-haspopup="true" aria-expanded="false" style="margin-left: 1%;">Save</button>
                            </div>
                        </div>
                        <h3 class="row" style="overflow: hidden;">
                                hardware sublist
                                <button type="button" class="btn btn-outline-dark btn-sm float-right">Edit</button>
                                <button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button>
                        </h3>
                        <div>
                            <ul id="sortable" class="sortable0">
                                    <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>Required Documentation-Universal<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                                    <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>In-field and pre-flight checklist-INS 01<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                                    <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>Hardware<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                                    <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>Easyware<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                            </ul>
                        </div>
                        <h3 class="row" style="overflow: hidden;">
                                universal sublist
                                    <button type="button" class="btn btn-outline-dark btn-sm float-right">Edit</button>
                                    <button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button>
                            </h3>
                            <div>
                                <ul id="sortable" class="sortable0">
                                        <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>Required Documentation-Universal<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                                        <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>In-field and pre-flight checklist-INS 01<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                                        <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>Hardware<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                                        <li class="ui-state-default" style="overflow: hidden;"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>Easyware<button type="button" class="btn btn-outline-danger btn-sm float-right">Delete</button></li>
                                </ul>
                            </div>
                </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function(){
        $('.createNewChecklist1').hide()
        $('.createNewChecklist2').hide()
    });
        $( function() {
          $( "#accordion, #accordion2" ).accordion();
        } );

        $( function() {
            $( ".sortable0" ).sortable();
            $( ".sortable0" ).disableSelection();
        } );

        $("#accordion, #accordion2").accordion({
    animate: {
        duration: 250
    }
});

    $('.createChecklistBtn').click(function(){
        $('.createNewChecklist1').toggle()
        $('.createNewChecklist2').toggle()

    })

    $(function(){
        $(".dropdown1 a").click(function(){
        $(".dropdown-toggle1:first-child").text($(this).text());
        $(".dropdown-toggle1:first-child").val($(this).text());
        });
        $(".dropdown2 a").click(function(){
        $(".dropdown-toggle2:first-child").text($(this).text());
        $(".dropdown-toggle2:first-child").val($(this).text());
        });
    });

//creating elements in the checklist tab
    $('.createElements input, #createAction').hide()
    $('.saveItemBtn').hide() 

    $('#createElementsSublist').click(function(){
        $('.saveItemBtn').show()
        $('.createElements input, #createAction').hide()
        $('#createSid').show()
    })

    $('#createElementsInput, #createElementsCheckBox').click(function(){
        $('.saveItemBtn').show()
        $('.createElements input, #createAction').hide()
        $('#createLabel, #createAction').show()
    })

    $('#createElementsDropDown').click(function(){
        $('.saveItemBtn').show()
        $('.createElements input, #createAction').hide()
        $('#createLabel, #createAction, #createList').show()
    })

    $('#createElementsActionNone').click(function(){
        //$('.createElements input, #createAction').hide()
        $('#createTrigger, #createAlert, #createTicket').hide()
    })

    $('#createElementsActionLockout').click(function(){
        //$('.createElements input, #createAction').hide()
        $('#createTrigger, #createAlert, #createTicket').show()
    })
    $('#createElementsActionTicket').click(function(){
        //$('.createElements input, #createAction').hide()
        $('#createAlert').hide()
        $('#createTrigger, #createTicket').show()
    })


    //___________________sub-list tab ______________________________________________________________
    $(document).ready(function(){
        $('.createNewChecklist1Sublist').hide()
        $('.createNewChecklist2Sublist').hide()
    });
    $('.createChecklistBtnSublist').click(function(){
        $('.createNewChecklist1Sublist').toggle()
        $('.createNewChecklist2Sublist').toggle()

    })



//creating elements in the checklist tab
    $('.createElementsSublist input, #createActionSublist').hide()
    $('.saveItemBtnSublist').hide() 

    $('#createElementsSublist').click(function(){
        $('.saveItemBtnSublist').show()
        $('.createElementsSublist input, #createActionSublist').hide()
        $('#createSidSublist').show()
    })

    $('#createElementsInputSublist, #createElementsCheckBoxSublist').click(function(){
        $('.saveItemBtnSublist').show()
        $('.createElementsSublist input, #createActionSublist').hide()
        $('#createLabelSublist, #createActionSublist').show()
    })

    $('#createElementsDropDownSublist').click(function(){
        $('.saveItemBtnSublist').show()
        $('.createElementsSublist input, #createActionSublist').hide()
        $('#createLabelSublist, #createActionSublist, #createListSublist').show()
    })

    $('#createElementsActionNoneSublist').click(function(){
        //$('.createElements input, #createAction').hide()
        $('#createTriggerSublist, #createAlertSublist, #createTicketSublist').hide()
    })

    $('#createElementsActionLockoutSublist').click(function(){
        //$('.createElements input, #createAction').hide()
        $('#createTriggerSublist, #createAlertSublist, #createTicketSublist').show()
    })
    $('#createElementsActionTicketSublist').click(function(){
        //$('.createElements input, #createAction').hide()
        $('#createAlertSublist').hide()
        $('#createTriggerSublist, #createTicketSublist').show()
    })
//---------------------------------

async function init_drone_list() {
        dl = document.getElementById('drone_list');
        // todo: properly make this async

        let responses = []
        responses.push(dronedb_p);
        responses.push(listdb_p);
        // console.log(responses)
        Promise.all(responses).then(value => {

            console.log(value)
            dronedb = value[0];
            listdb = value[1];

            list_options = ``;
            listdb.lists.forEach(l => {
                list_options += `<option value='${l.lid}'>${l.label}</option>`;
            })

            let adddiv = document.getElementById('add_drone');
            adddiv.innerHTML = gen_drone_form(null, list_options)
            document.getElementById(`edit_form_-1`).onsubmit = addSubmit
            // console.log(dronedb);
            dronedb.drones.forEach((d) => {
                let item = gen_drone_item(d, list_options);
                dl.appendChild(item);
                document.getElementById(`edit_form_${d.did}`).onsubmit = editSubmit

            });

        });
    }

    let checklistdb = {};
    let list_options = ``;
    //init_drone_list();

</script>

</body>
</html>